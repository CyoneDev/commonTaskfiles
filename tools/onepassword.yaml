# https://taskfile.dev

version: '3'
includes:
  op: https://raw.githubusercontent.com/CyoneDev/commonTaskfiles/main/tools/onepassword_{{OS}}.yaml

tasks:
  set-secrets:
    desc: "Ensure 1Password CLI is installed and OP_SERVICE_ACCOUNT_TOKEN is set. Inject secrets into .env file."
    deps: [op:install]
    cmds:
      - echo "{{.GREETING}} You are on {{OS}}"
      - task op:check-token-valid #not calling it with task: because i need it to initialize a new shell to load the .env file that was generated by the previous command 
      - task op:inject-secrets -- DIR "{{.SECRETS_DIR}}"
